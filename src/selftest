#  Run selftests and check memory
cd ../model
./generate
cd ../src
gcc -g -o fmq_selftest fmq_*.c ${CFLAGS} ${LDFLAGS} -lczmq -lzmq
if [ $? -eq 0 ]; then
    if [ "$1" == "-q" ]; then
        ./fmq_selftest
    else
        echo "Starting Valgrind memcheck..."
        valgrind --tool=memcheck --leak-check=full --suppressions=valgrind.supp ./fmq_selftest
    fi
fi
rm -f vgcore.*

